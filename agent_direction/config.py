#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
方向预测专家配置参数
"""

# ============================================================================
# 预测执行配置参数 - 可手动修改
# ============================================================================

# 日期范围配置
START_DATE = '2024-10-01'  # 起始日期（格式：YYYY-MM-DD）
END_DATE = '2025-09-30'    # 截止日期（格式：YYYY-MM-DD）


# 特定基金代码（可选）
# 如果为空列表，则处理全部基金
# 如果填写基金代码，则只处理指定的基金
SPECIFIC_FUND_CODES = []  # 例如: ['508018.SH', '508001.SH']

# 基金上市时间要求
MIN_LISTED_DAYS = 365  # 基金必须上市超过多少天（默认365天，即一年）

# 价格上下文配置
PRICE_CONTEXT_DAYS = 20  # 获取最近N个交易日的收盘价（详细展示20日，并计算5日和20日涨跌幅）

# 日志配置
LOG_MODE = 'detailed'  # 'detailed' 或 'simple'
# detailed: 记录详细过程（当前执行位置、四专家返回内容、传递给LLM的内容、LLM返回内容、写入数据库的内容）
# simple: 只记录每次执行的情况

# LLM推理过程显示
SHOW_REASONING = True  # 是否在日志和终端中显示LLM的推理过程

# ============================================================================
# 四专家调用配置
# ============================================================================

# 是否异步调用四个专家
ASYNC_EXPERTS = True  # True: 异步并行调用, False: 同步顺序调用

# 专家调用超时时间（秒）
EXPERT_TIMEOUT = 600  # 每个专家的超时时间

# ============================================================================
# 数据库配置
# ============================================================================

# 预测结果表名
PREDICTION_TABLE = 'price_predictions'

# ============================================================================
# 其他配置
# ============================================================================

# 重试配置
MAX_RETRIES = 3  # LLM调用失败时的最大重试次数

# ============================================================================
# 多线程与批次处理配置
# ============================================================================

# 是否启用多线程处理
ENABLE_MULTITHREAD = True  # True: 多线程处理, False: 单线程顺序处理

# 线程池大小（并发处理的组合数量）
THREAD_POOL_SIZE = 20  # 平衡方案：5个线程
# 说明：
#   - 保守方案：2-3个线程
#   - 平衡方案：5-8个线程
#   - 激进方案：10-15个线程（需注意数据库连接数，当前MySQL最大连接数500）
#   - 考虑到四专家也可能异步调用，理论峰值连接数 ≈ THREAD_POOL_SIZE × 5

# 批次处理配置
ENABLE_BATCH_PROCESSING = True  # 是否启用批次处理
BATCH_SIZE = 100  # 每批处理的组合数量
# 说明：
#   - 较小批次(50)：更频繁的进度反馈，适合测试
#   - 平衡批次(100)：平衡性能和反馈频率
#   - 较大批次(200-500)：减少批次切换开销

# 批次间延迟（秒）
BATCH_DELAY = 0  # 批次间等待时间，0表示不等待
# 说明：如果担心数据库压力，可设置1-3秒的延迟

# 单个组合处理超时时间（秒）
COMBINATION_TIMEOUT = 600  # 单个组合的最大处理时间（默认10分钟）
# 说明：超过此时间的组合将被标记为超时失败

# ============================================================================
# 评估体系配置参数
# ============================================================================

# 三个时间维度的标识
TIME_HORIZONS = ['T+1', 'T+5', 'T+20']

# 三个时间维度的权重（短期权重最高）
# 用于 correctness, intensity, confidence_mix 的加权计算
WEIGHT_T1 = 0.6
WEIGHT_T5 = 0.3
WEIGHT_T20 = 0.1

# 阈值扩展系数（基于单日阈值 θₜ 计算多日阈值）
# ε₁ = θₜ, ε₅ = √5·θₜ, ε₂₀ = √20·θₜ
import math
THRESHOLD_MULTIPLIER_T1 = 1.0
THRESHOLD_MULTIPLIER_T5 = math.sqrt(5)
THRESHOLD_MULTIPLIER_T20 = math.sqrt(20)

# consistency 因子（当前固定为1，后续可调整）
CONSISTENCY_FACTOR = 1.0

# ============================================================================
# 价格与盘整评分配置
# ============================================================================

# 5日盘整状态判断系数
# 说明：5日涨跌幅阈值 = √5 × 单日波动阈值
REGIME_5D_SQRT_MULTIPLIER = math.sqrt(5)

# 20日盘整状态判断系数
# 说明：20日涨跌幅阈值 = √20 × 单日波动阈值
REGIME_20D_SQRT_MULTIPLIER = math.sqrt(20)

# ============================================================================

