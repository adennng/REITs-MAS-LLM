#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
决策专家配置文件
包含所有可配置的参数
"""

import math

# =============================================================================
# 回测范围配置
# =============================================================================

# 回测日期范围
START_DATE = "2024-10-01"  # 起始日期
END_DATE = "2025-09-30"    # 终止日期

# 基金代码列表（如果为空列表则使用该日期范围内所有基金）
FUND_CODES = []  # 例如: ["508018.SH", "180201.SZ"]

# 基金上市天数要求
# 说明：只纳入在回测起始日期(START_DATE)时就已上市满指定天数的基金
# 与对照组(baseline_strategies)保持一致，确保两者使用相同的基金池
MIN_LISTED_DAYS = 365  # 365天(1年)

# =============================================================================
# 并行处理配置
# =============================================================================

# 最大并行进程数
# 说明：
#   - 每个基金独立运行一个进程，多进程并行处理可显著提升效率
#   - 建议值：CPU核心数的 50%-80%（为系统保留部分资源）
#   - 例如：8核CPU建议设置为 4-6
#   - 设置为 1 则串行处理（调试时推荐）
#   - 设置为 None 或 0 则自动根据CPU核心数和基金数量决定
# 实际使用进程数 = min(MAX_WORKERS, 基金数量, CPU核心数)
MAX_WORKERS = 20  # 建议值：4-6（根据你的服务器配置调整）

# 是否启用断点续传
# 说明：
#   - True: 会检查数据库中已有的决策记录，只处理未完成的交易日
#   - False: 每次都从头开始处理（会跳过数据库中已有记录的日期，避免重复）
# 建议：保持 True，节省LLM调用成本和时间
ENABLE_RESUME = True

# =============================================================================
# 账户配置
# =============================================================================

# 初始资金（单位：元）
INITIAL_CAPITAL = 1000000.0  # 100万

# =============================================================================
# 仓位管理参数
# =============================================================================

# 最大允许仓位
POSITION_MAX = 1.0

# 最小仓位调整步长
STEP = 0.2

# 单日最大调整步数
K_MAX = 2

# =============================================================================
# 建仓期参数
# =============================================================================

# 建仓期目标仓位上限
BUILDING_TARGET_POSITION = 0.6

# 建仓期最长天数
D_BUILD_MAX = 20

# 建仓完成阈值（仓位达到该值视为建仓完成）
P_BUILD_DONE = 0.6

# =============================================================================
# 风险控制参数
# =============================================================================

# 软最大回撤阈值（例如 -0.08 即 -8%）
SOFT_DD_LIMIT = -0.05

# 硬最大回撤阈值（例如 -0.15 即 -15%）
HARD_DD_LIMIT = -0.10

# 止盈参考水平（例如 0.15 即 +15%）
TAKE_PROFIT_LEVEL = 0.15

# 止盈前最小持仓天数
MIN_HOLDING_DAYS_BEFORE_TP = 5

# =============================================================================
# 手续费配置
# =============================================================================

# 买入手续费率
FEE_RATE_BUY = 0.0003  # 0.03%

# 卖出手续费率
FEE_RATE_SELL = 0.0003  # 0.03%

# =============================================================================
# 信号分档参数
# =============================================================================
# 说明：
#   档位判断基于主导方向概率和置信度两个维度（不再使用边际差距）
#   档位体系（7档）：
#   - strong_long/strong_short: 强多/强空信号
#   - medium_long/medium_short: 中多/中空信号
#   - weak_long/weak_short: 弱多/弱空信号
#   - neutral: 中性信号（主导方向为横盘，或概率/置信度不满足阈值）

# 强信号阈值（需同时满足主导概率和置信度要求）
SIGNAL_P_STRONG = 0.70    # 强信号主导概率阈值
SIGNAL_CONF_STRONG = 0.60  # 强信号置信度阈值

# 中等信号阈值（需同时满足主导概率和置信度要求）
SIGNAL_P_MEDIUM = 0.60    # 中等信号主导概率阈值
SIGNAL_CONF_MEDIUM = 0.60  # 中等信号置信度阈值

# 弱信号阈值（仅需满足主导概率要求）
SIGNAL_P_WEAK = 0.50      # 弱信号主导概率阈值（最低阈值）

# =============================================================================
# LLM配置
# =============================================================================

# 使用的模型
LLM_PROVIDER = "deepseek"
LLM_MODEL = "deepseek-reasoner"

# 温度参数（较低以保证决策稳定性）
LLM_TEMPERATURE = 0.6

# 最大重试次数
LLM_MAX_RETRIES = 3

# =============================================================================
# 日志配置
# =============================================================================

# 日志目录
LOG_DIR = "/root/code/REITsInvest/log"

# 日志文件名前缀
LOG_FILE_PREFIX = "trading_agent"

# =============================================================================
# 数据库表名
# =============================================================================

# 高级推理LLM决策记录表
TABLE_DECISIONS_STRONG = "trading_decisions_strong"

# =============================================================================
# 价格与盘整状态配置
# =============================================================================

# 5日盘整状态判断系数
# 说明：5日涨跌幅阈值 = √5 × 单日波动阈值
#   - √5 ≈ 2.236（理论值，基于随机游走假设下方差的叠加规律）
REGIME_5D_SQRT_MULTIPLIER = math.sqrt(5)
